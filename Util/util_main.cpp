#include <cstddef>
#include <cstdio>
#include <cstdlib>
#include <sys/socket.h>

#include "Util.hpp"
#include "../ScannerResponse.hpp"


int main(int argc, char** argv) {
    if (argc == 1) {
        std::fprintf(stderr, "Error: path to the directory to scan must be specified in argv[1]\n");
        std::exit(EXIT_FAILURE);
    }

    ScannerResponse res = Util::MakeRequest(argv[1]);
    std::size_t t = res.exection_time_s;

    std::puts("====== Scan result ======");
    std::printf("Processed files: %lu\n", res.processed_files);
    std::printf("JS detects: %lu\n", res.js_detects);
    std::printf("Unix detects: %lu\n", res.unix_detects);
    std::printf("macOS detects: %lu\n", res.macos_detects);
    std::printf("Errors: %lu\n", res.errors);
    std::printf("Exection time: %02lu:%02lu:%02lu\n", t / 3600, t % 3600 / 60, t % 60);
    std::puts("=========================");

    return 0;
}

